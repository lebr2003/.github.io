<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Foto Download</title>
    <script src="https://code.jquery.com/jquery-3.6.4.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/rawdevjs@0.5.0/dist/rawdev.min.js"></script>
</head>
<body>

    <h1>Foto Download</h1>

    <!-- Verlinke hier deine Fotos und XMP-Dateien auf GitHub -->
    <button onclick="convertAndDownload()">Download Foto</button>

    <script>
        async function convertAndDownload() {
            // Hier den Pfad zu deiner RAW-Datei und XMP-Datei einfügen
            const rawFilePath = 'https://apotheke.leanderbrunar.net/Programme/Fotodownload/P1310062-2.RW2';
            const xmpFilePath = 'https://apotheke.leanderbrunar.net/Programme/Fotodownload/P1310062-2.xmp';

            // Lade die RAW-Datei und XMP-Datei
            const rawResponse = await fetch(rawFilePath);
            const rawArrayBuffer = await rawResponse.arrayBuffer();

            const xmpResponse = await fetch(xmpFilePath);
            const xmpText = await xmpResponse.text();

            // Konvertiere RAW zu JPG mit RawDevjs
            const rawDev = new RawDev();
            const imageData = rawDev.decode(rawArrayBuffer);
            const jpgDataUrl = rawDev.toDataUrl(imageData, 'image/jpeg');

            // Füge XMP-Metadaten hinzu
            const blob = await fetch(jpgDataUrl).then(response => response.blob());
            const jpgWithMetadata = new File([blob], 'ConvertedPhoto.jpg', {
                type: 'image/jpeg',
            });

            // Erstelle einen Download-Link
            const url = URL.createObjectURL(jpgWithMetadata);
            const a = document.createElement('a');
            a.href = url;
            a.download = jpgWithMetadata.name;

            // Füge den Link zum Dokument hinzu und simuliere einen Klick
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
        }
    </script>

</body>
</html>
